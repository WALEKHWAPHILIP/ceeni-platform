{# apps/user_profiles/templates/user_profiles/screens/s2_location_info.html #}
{% extends "user_profiles/base/wizard_base.html" %}

{% block title %}Step 2 â€” Your Location{% endblock %}

{% block wizard_content %}
  <div class="space-y-6">

    {# County selector (triggers loading of constituencies) #}
    <div>
      <label for="id_county" class="block text-sm font-semibold text-gray-700 mb-1">
        {{ form.county.label }}
      </label>
      <select
        name="county"
        id="id_county"
        class="select select-bordered w-full rounded-lg shadow-sm focus:ring-green-600 transition duration-300"
        hx-get="{% url 'user_profiles:htmx_constituencies' %}"
        hx-target="#id_constituency"
        hx-trigger="change"
        hx-include="this"
      >
        <option value="">--------- Select a county ---------</option>
        {% for val, lbl in form.fields.county.choices %}
          <option value="{{ val }}"
            {% if form.instance.county_id|stringformat:"s" == val|stringformat:"s" %}selected{% endif %}>
            {{ lbl }}
          </option>
        {% endfor %}
      </select>
      {% if form.county.help_text %}
        <p class="text-xs text-gray-500 italic mt-1">{{ form.county.help_text }}</p>
      {% endif %}
      {% for err in form.county.errors %}
        <p class="text-sm text-red-600 mt-1">{{ err }}</p>
      {% endfor %}
    </div>

    {# Constituency selector (triggers loading of wards) #}
    <div>
      <label for="id_constituency" class="block text-sm font-semibold text-gray-700 mb-1">
        {{ form.constituency.label }}
      </label>
      <select
        name="constituency"
        id="id_constituency"
        class="select select-bordered w-full rounded-lg shadow-sm focus:ring-green-600 transition duration-300"
        hx-get="{% url 'user_profiles:htmx_wards' %}"
        hx-target="#id_ward"
        hx-trigger="change"
        hx-include="this"
      >
        <option value="">--------- Select a constituency ---------</option>
        {% for val, lbl in form.fields.constituency.choices %}
          <option value="{{ val }}"
            {% if form.instance.constituency_id|stringformat:"s" == val|stringformat:"s" %}selected{% endif %}>
            {{ lbl }}
          </option>
        {% endfor %}
      </select>
      {% if form.constituency.help_text %}
        <p class="text-xs text-gray-500 italic mt-1">{{ form.constituency.help_text }}</p>
      {% endif %}
      {% for err in form.constituency.errors %}
        <p class="text-sm text-red-600 mt-1">{{ err }}</p>
      {% endfor %}
    </div>

    {# Ward selector #}
    <div>
      <label for="id_ward" class="block text-sm font-semibold text-gray-700 mb-1">
        {{ form.ward.label }}
      </label>
      <select
        name="ward"
        id="id_ward"
        class="select select-bordered w-full rounded-lg shadow-sm focus:ring-green-600 transition duration-300"
      >
        <option value="">--------- Select a ward ---------</option>
        {% for val, lbl in form.fields.ward.choices %}
          <option value="{{ val }}"
            {% if form.instance.ward_id|stringformat:"s" == val|stringformat:"s" %}selected{% endif %}>
            {{ lbl }}
          </option>
        {% endfor %}
      </select>
      {% if form.ward.help_text %}
        <p class="text-xs text-gray-500 italic mt-1">{{ form.ward.help_text }}</p>
      {% endif %}
      {% for err in form.ward.errors %}
        <p class="text-sm text-red-600 mt-1">{{ err }}</p>
      {% endfor %}
    </div>

  </div>

  {# Kenya-flag separator #}
  {% include "user_profiles/partials/_kenya_flag_hr_separator.html" %}
{% endblock %}

{% block wizard_nav %}
  {% url 'user_profiles:screen_1' as back_url %}
  {% include "user_profiles/partials/_wizard_back_button.html" with back_url=back_url %}
  {% include "user_profiles/partials/_wizard_button.html" %}
{% endblock %}
